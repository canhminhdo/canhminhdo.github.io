<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="google652b6e851dbdf40b.html"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Lvalues and Rvalues in C++ | Canh Minh Do</title> <meta name="author" content="Canh Minh Do"> <meta name="description" content="Computer Science, Software Engineering, Formal Methods. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/bio-photo-favicon.jpg"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://canhminhdo.github.io/blog/2023/lvalues-and-rvalues-in-c++/"> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Canh </span>Minh Do</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/profile/">Profile</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">Teaching</a> </li> <li class="nav-item "> <a class="nav-link" href="/research/">Research</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/news/">News</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Lvalues and Rvalues in C++</h1> <p class="post-meta">January 1, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/category/c"> <i class="fas fa-tag fa-sm"></i> C++</a>   </p> </header> <article class="post-content"> <div id="markdown-content" style="text-align: justify;"> <p>Lvalues và Rvalues là khái niệm quan trọng trong C++ để có thể hiểu được những chức năng mới được giới thiệu từ C++11. Trong C++, một lvalue được trỏ tới một vị trí cụ thể trong bộ nhớ. Còn một rvalue không được trỏ tới đâu cả. Rvalues là tạm thời và tồn tại trong thời gian ngắn, trong khi đó lvalues có thể tồn tại lâu dài miễn là biến đó vẫn tồn tại. Nếu bạn nghĩ lvalues và một nơi chứa thì rvalues là thứ được chứa trong đó. Không có nơi chứa thì những thứ đó sẽ không tồn tại.</p> <p>Hãy cùng đi vào một ví dụ cụ thể sau:</p> <pre><code class="language-C++">int x = 8888; // ok
</code></pre> <p>Trong ví dụ này <code class="language-plaintext highlighter-rouge">8888</code> là một rvalue, một hằng số đơn thuần và không có một địa chỉ bộ nhớ cụ thể nào ngoài việc được lưu trữ ở trong thanh ghi tạm thời khi chương trình đang chạy. Biến <code class="language-plaintext highlighter-rouge">x</code> có một giá trị bộ nhớ cụ thể và được gán giá trị <code class="language-plaintext highlighter-rouge">8888</code>, vì vậy <code class="language-plaintext highlighter-rouge">x</code> là một rvalue. Trong C++ thì toán tử gán yêu cầu toán hạng bên trái là một lvalue, trong khi đó toàn hạng bên phải có thể là lvalue hoặc rvalue.</p> <pre><code class="language-C++">int* y = &amp;x; // ok
666 = x; // error!
</code></pre> <p>Một vài ví dụ trên cho bạn hình dung rằng chúng ta không thể sử dụng một rvalue cho toán hạng ở bên trái.</p> <h3 id="functions-trả-về-lvalues-và-rvalues">Functions trả về lvalues và rvalues</h3> <p>Nếu functions trả về rvalues và được sử dụng trong phép gán bên tay trái là không hợp lệ như sau:</p> <pre><code class="language-C+">int setValue() {
    return 6;
}
setValue() = 3; // error!
</code></pre> <p>Tuy nhiên nếu functions trả về lvalues, chúng ta có thể sử dụng trong phép gán như sau:</p> <pre><code class="language-C++">int global = 100;
int&amp; setGlobal() {
    return global;
}
setGlobal() = 400; // OK
</code></pre> <p>Một tham chiếu (<code class="language-plaintext highlighter-rouge">reference</code>) trỏ tới một địa chỉ bộ nhớ cụ thể đã tồn lại. Vì vậy nó cũng được coi là lvalue. Chú ý rằng <code class="language-plaintext highlighter-rouge">&amp;</code> sử dụng trong kiểu giá trị trả về của hàm ở trên không phải là toán tử lấy về địa chỉ, nó được sử dụng để định nghĩa giá trị trả về là một <code class="language-plaintext highlighter-rouge">lvalue reference</code> (chúng ta sẽ tìm hiểm trong phần dưới).</p> <h3 id="chuyển-lvalues-sang-rvalues">Chuyển lvalues sang rvalues</h3> <p>Một lvalue có thể được chuyển thành rvalue. Ví dụ toán tử <code class="language-plaintext highlighter-rouge">+</code> trong C++ yêu cầu hai toán hạng là rvalues. Tuy nhiên hãy xem ví dụ sau:</p> <pre><code class="language-C++">int x = 1;
int y = 2;
int z = x + y; // ok
</code></pre> <p>Rõ ràng <code class="language-plaintext highlighter-rouge">x</code> và <code class="language-plaintext highlighter-rouge">y</code> là lvalues, nhưng toán tử <code class="language-plaintext highlighter-rouge">+</code> mong muốn rvalues. C++ sẽ ngầm chuyển đổi lvalues sang rvalues cho chúng ta.</p> <h3 id="lvalue-reference">Lvalue reference</h3> <p>Liệu rvalues có thể được chuyển thành lvalues? Câu trả lời là không.</p> <pre><code class="language-C++">int x = 10;
int&amp; xref = x;
xref++; // x is now 11
</code></pre> <p>Chúng ta đang khai báo <code class="language-plaintext highlighter-rouge">xref</code> là một biến tham chiếu tới <code class="language-plaintext highlighter-rouge">x</code> và được gọi là <code class="language-plaintext highlighter-rouge">lvalue reference</code>. Giờ chúng ta có thể thay đổi giá trị <code class="language-plaintext highlighter-rouge">x</code> thông qua <code class="language-plaintext highlighter-rouge">xref</code>. Nếu chúng ta gán <code class="language-plaintext highlighter-rouge">10</code> tới <code class="language-plaintext highlighter-rouge">xref</code> như ví dụ dưới liệu có hợp lệ không?</p> <pre><code class="language-C++">int&amp; xref = 10; // will it work?
</code></pre> <p>Toán hạng bên phải là một giá trị tạm thời và cần phải được lưu trữ ở đâu đó trong một lvalue để có thể tham chiếu tới. Nhưng <code class="language-plaintext highlighter-rouge">10</code> là một giá trị cụ thể và không có một địa chỉ cụ thể trong bộ nhớ. Vì vậy ta không thể làm như vậy. Tương tự như trong ví dụ sau:</p> <pre><code class="language-C++">void func(int&amp; x) {}
int main() {
    func(10); // error
}
</code></pre> <h3 id="const-lvalue-reference-có-thể-giải-quyết-được">Const lvalue reference có thể giải quyết được</h3> <p>Tuy nhiên, chúng ta có thể sử dụng một <code class="language-plaintext highlighter-rouge">const lvalue</code> để gắn một rvalue như sau:</p> <pre><code class="language-C++">const int&amp; ref = 10; // ok
</code></pre> <p>Và ví dụ sau cũng hoàn toàn hợp lệ:</p> <pre><code class="language-C++">void func(const int&amp; x) {}
int main() {
    func(10); // OK
}
</code></pre> <p>Giá trị <code class="language-plaintext highlighter-rouge">10</code> sẽ hết hạn ngay lập tức, vì vậy một <code class="language-plaintext highlighter-rouge">reference</code> tới nó là không có ý nghĩa gì. Tuy nhiên chúng ta có thể tạo biến <code class="language-plaintext highlighter-rouge">const lvalue reference</code> với giá trị trỏ đến không thể bị thay đổi. Để có thể làm vậy C++ compiler sẽ tạo một <code class="language-plaintext highlighter-rouge">hidden variable</code> để lưu trữ giá trị <code class="language-plaintext highlighter-rouge">10</code> và gắn <code class="language-plaintext highlighter-rouge">hidden variable</code> tới biến tham chiếu như sau.</p> <pre><code class="language-C++">const int&amp; ref = 10;

// would translate to
int __internal_unique_name = 10;
const int&amp; ref = __internal_unique_name;
</code></pre> <p>Bây giờ mọi thử trở dễ hiểu hơn khi biến tham chiếu trỏ tới một vị trí bộ nhớ cụ thể và chúng ta có thể dụng như bình thường nhưng không được sửa đổi nó.</p> <h3 id="kết-luận">Kết luận</h3> <p>Hiểu được ý nghĩa của lvalues và rvalues giúp chúng ta hiểu được những khái niệm mới như rvalue references, move semantics và perfect forwarding trong các bài viết tới.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/C++-static-library-va-dynamic-library/">C++ static library và dynamic library</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/nhung-luu-y-khi-viet-code-de-chuong-trinh-tro-len-sang-sua-va-mach-lac/">Những lưu ý khi viết code để chương trình trở lên sáng sủa và mạch lạc</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/ban-that-su-da-biet-ve-bit-shifting/">Bạn thật sự đã biết về Bit shifting</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/hash-tables/">Hash tables</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/cach-bieu-dien-so-am-trong-trong-may-tinh/">Cách biểu diễn số âm trong máy tính</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0 text-center"> © Copyright 2024 Canh Minh Do. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163449648-1"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-163449648-1");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>