<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="google652b6e851dbdf40b.html"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>C++ static library và dynamic library | Canh Minh Do</title> <meta name="author" content="Canh Minh Do"> <meta name="description" content="Computer Science, Software Engineering, Formal Methods. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://canhminhdo.github.io/blog/2021/C++-static-library-va-dynamic-library/"> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Canh </span>Minh Do</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/profile/">Profile</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">Teaching</a> </li> <li class="nav-item "> <a class="nav-link" href="/research/">Research</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/news/">News</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">C++ static library và dynamic library</h1> <p class="post-meta">December 3, 2021</p> <p class="post-tags"> <a href="/blog/2021"> <i class="fas fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/category/c"> <i class="fas fa-tag fa-sm"></i> C++</a>   </p> </header> <article class="post-content"> <div id="markdown-content" style="text-align: justify;"> <p>Tôi có hội làm việc với C++ thông qua một dự án nhỏ cần phải thêm mới một vài chức năng. Dự án đó sử dụng autotools để quản lý các configuration, make và dependencies. Trong quá trình phát triển và build dự án để có thể chạy được trên các máy khác nhau, tôi cần phải chọn cách build dự án thông qua static library hoặc dynamic library? Để có thể chạy trên các nền tảng máy khác nhau e.g. x86, x86_64, cần phải build các library cho từng nền tảng máy đó vì mỗi nền tảng hỗ trợ những tập lệnh khác nhau và build chương trình của mình link cùng với các library đó cho các nền tảng tương ứng.</p> <p><strong>1. Quá trình build một chương trình C++</strong> Trong C/C++ để build một chương trình sẽ trải qua những bước như sau:</p> <ul> <li> <p>Processor: source code sẽ được tiền xử lý như là xóa đi các comments, expand những include từ headers files, replace các macros bạn định nghĩa vào những chỗ bạn sử dụng trong source code.</p> </li> <li> <p>Complie: preprocessed code sẽ được complie về dạng assembly code, bạn có thể đọc được những mã lệnh assembly code này nếu bạn đã từng lập trình với assembly.</p> </li> <li> <p>Assembler: assembly code sẽ được chuyển về dạng mã máy để có thể chạy được trên máy tính của bạn. Bạn có thể gọi đây là các object code.</p> </li> <li> <p>Linker: Các object code này sẽ được link với các dependencies hoặc có thể hiểu là các library bạn sử dụng trong chương trình, bạn cần link vào thì chương trình mới có thể chạy được, ngoài ra thì chương trình của bạn sẽ không hiểu nó là cái gì, ngoài một interface được chứa trong file <strong>.h</strong>.</p> </li> </ul> <p>Khi build chương trình bạn có thể tùy chọn là sử dụng static library hay dynamic library. Một một cái sẽ có pros và cons khác nhau.</p> <p><strong>2. Static library (.a, .lib)</strong> Static library là tập hợp các object files được link cùng với chương trình khi bạn build một file có thể chạy được. Vì vậy library code sẽ được link vào chương trình trong quá trình complie time, vì vậy chương trình được build sẽ chứa nhiều files và nặng hơn. Tuy nhiên tốc độ sẽ nhanh hơn vì bạn không phải mất thời gian để load library trong khi run-time. Một điểm đặc biệt chú ý là khi bạn muốn thay đổi static libraries bạn phải build lại toàn bộ chương trình.</p> <p><strong>3. Dynamic library (.so, .dll, .dylib)</strong> Trái ngược với static library, dynamic library sẽ được link vào trong chương trình trong khi run-time, vì vậy kích thước của chương trình được build ra sẽ nhỏ hơn và đặc biệt là bạn không cần phải complie lại chương trình khi thay đổi version của các library đó. Nhược điểm là sẽ làm chậm quá trình run time vì phải đợi để load những dynamic library vào chương trình khi chạy.</p> <p>Khi sử dụng dynamic library bạn cần chú ý biến environment <strong>LD_LIBRARY_PATH</strong> sẽ được linker sử dụng để tìm kiếm các dynamic library.</p> <p><strong>4. Một vài flags cần phải nắm khi build chương trình C++</strong> Chúng ta có thể overwrite những mặc định khi build chương trình với những flag như sau:</p> <p><strong>CC</strong> là C complider command.</p> <p><strong>CFLAGS</strong> là C complier flags.</p> <p><strong>LDFLAGS</strong>* là linker flags, e.g. -L&lt;lib dir&gt; nếu bạn có library không phải standard library và nằm ở thư mục đâu đó.</p> <p><strong>LIBS</strong> libarary bạn muốn nói cho linkers biết, e.g. -l&lt;library&gt;. Trong trường hợp sử dụng static library, bạn nên chỉ đến đúng đường dẫn của libary đó, e.g. /path/to/libary.a</p> <p><strong>CPPFLAGS</strong> là C/C++ preprocessor flags, e.g -I&lt;include dir&gt; nếu bạn sử dụng headers file của nhưng nonstandard libary nằm ở thư mục đâu đó.</p> <p><strong>CXX</strong> là C++ complier command.</p> <p><strong>CXXFLAGS</strong> là C++ complier flags.</p> <p>Dưới đây là câu lệnh mình sử dụng để configure cho dự án của mình trước khi complie bằng câu lệnh make.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>../configure \
--with-yices2=yes \
--with-cvc4=no \
FLEX=/opt/local/bin/flex \
BISON=/usr/local/bin/bison \
CFLAGS="-g -Wall -O3 -fno-stack-protector -fstrict-aliasing" \
CXXFLAGS="-g -Wall -O3 -fno-stack-protector -fstrict-aliasing -std=c++11" \
CPPFLAGS="-I/Users/Darwin64/include" \
LDFLAGS="-L/Users/Darwin64/lib" \
LIBSIGSEGV_LIB="/Users/Darwin64/lib/libsigsegv.a" \
BUDDY_LIB="/Users/Darwin64/lib/libbdd.a" \
YICES2_LIB="/Users/Darwin64/lib/libyices.a" \
TECLA_LIBS="/Users/Darwin64/lib/libtecla.a /Users/Darwin64/lib/libtecla_r.a -lcurses" \
GMP_LIBS="/Users/Darwin64/lib/libgmpxx.a /Users/Darwin64/lib/libgmp.a" \
--prefix="${CWD}/dist"
</code></pre></div></div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/lvalues-and-rvalues-in-c++/">Lvalues and Rvalues in C++</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/nhung-luu-y-khi-viet-code-de-chuong-trinh-tro-len-sang-sua-va-mach-lac/">Những lưu ý khi viết code để chương trình trở lên sáng sủa và mạch lạc</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/ban-that-su-da-biet-ve-bit-shifting/">Bạn thật sự đã biết về Bit shifting</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/hash-tables/">Hash tables</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/cach-bieu-dien-so-am-trong-trong-may-tinh/">Cách biểu diễn số âm trong máy tính</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0 text-center"> © Copyright 2025 Canh Minh Do. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/ajax/libs/js-polyfills/0.1.43/polyfill.min.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163449648-1"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-163449648-1");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>